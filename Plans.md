# 開発計画

## 概要
本リポジトリは Create T3 App をベースにした Next.js + NextAuth.js + Drizzle/Prisma + tRPC 構成で、スマートフォンブラウザ利用を前提とした画像・動画ストレージサービスの開発基盤を提供する。

## 開発要件整理

### 機能要件
1. 認証・認可
  - サインアップ
  - メール＋パスワード、もしくは外部 IdP と連携したログイン／ログアウト
  - ロール（管理者／一般）や共有リンクのパーミッション制御
2. メディア管理
  - 画像・動画のアップロード（複数ファイル、進捗表示、失敗時リトライ）
  - 保存後のメタデータ登録（タイトル、説明、タグ、作成者、公開設定）
  - ダウンロード／再生用の署名付き URL 生成
3. 共有機能
  - 個別ユーザー招待（メール通知、権限設定）
  - 共有リンク生成と有効期限／パスワード保護
  - アクティビティログ（共有・アクセス履歴）
4. プレビュー機能
  - サムネイル生成、動画のトランスコード（低解像度版など）
  - モバイル向けレスポンシブ UI、スワイプ操作、一覧での無限スクロール
5. アカウント・設定
  - プロフィール編集、パスワード変更、2FA オプション
  - ストレージ使用量表示、プラン変更、通知設定

### 非機能要件
- **モバイル最適化**: タッチ操作、レスポンシブレイアウト、LCP/CLS/SI 指標の最適化。
- **セキュリティ**: HTTPS 前提、署名付き URL、CSRF/クリックジャック対策、OWASP ASVS 準拠、コンテンツ検閲（ウイルススキャン）。
- **スケーラビリティ**: オブジェクトストレージ（S3/GCS 等）、CDN 配信、バックグラウンド処理キュー。
- **可観測性**: アクセスログ、メトリクス、アラート設計。
- **テスト**: 新規関数ごとの単体テスト、E2E（Playwright など）、負荷・回帰テスト。
- **ドキュメント**: README/開発者ガイド更新、API スキーマ（OpenAPI/trpc schema）整備。

## アーキテクチャ指針
- フロント: Next.js App Router、Tailwind CSS、tRPC で型安全 API。
- バックエンド: Next.js API Routes/tRPC で BFF、Drizzle/Prisma を用いた DB 層、Clean Architecture を意識した層分け。
- インフラ: DB（PostgreSQL 等）、オブジェクトストレージ、ジョブキュー（BullMQ/Cloud Tasks）、CI/CD（GitHub Actions + Vercel/Container）。
- Config/秘密情報: .env 管理、Secrets Manager 併用。

## 開発ステップ
1. プロジェクト準備
  - 要件定義書/ER 図/ユースケース作成、ストレージ・配信戦略選定。
  - 開発環境（Node、DB、ストレージエミュレータ）と CI/CD パイプライン整備。
2. 基盤実装
  - Next.js App Router 構成整理、Tailwind ベースの共通 UI コンポーネント実装。
  - データモデル策定（ユーザー、メディア、共有リンク等）とマイグレーション。
  - 認証（NextAuth.js）と RBAC の導入。
3. メディアアップロード／保存
  - フロントでのアップロード UI、ドラッグ＆ドロップ、プログレス表示。
  - バックエンドでプリサインド URL 発行、アップロード後のメタデータ保存、ウイルススキャン。
4. メディア処理パイプライン
  - アップロード後の非同期ジョブ（サムネイル生成、動画トランスコード）。
  - 処理結果の状態管理とユーザーへの通知。
5. 閲覧・共有機能
  - モバイルフレンドリーなギャラリー表示、検索／フィルタリング。
  - 共有リンク作成、期限・パスワード設定 UI、アクセスログ表示。
  - 個別ユーザー招待と通知メール送信。
6. ダウンロード・プレビュー
  - 署名付き URL による安全なダウンロード。
  - 画像プレビュー、動画ストリーミング（HLS/DASH）の実装。
7. アカウント管理・課金（必要なら）
  - プロフィール編集、ストレージ使用量表示。
  - サブスクリプション／課金連携の設計。
8. 品質保証
  - 単体・統合・E2E テスト充実、CI 自動実行。
  - パフォーマンス・セキュリティ診断（Lighthouse、OWASP ZAP など）。
9. 運用準備
  - 監視・アラート設定（ログ、メトリクス、通知）。
  - バックアップ／DR 計画、SLA/SLO 定義。
  - README/開発ドキュメント更新、リリース手順書作成。
